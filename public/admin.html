<!DOCTYPE html>
<html>
<head>
  <title>Admin Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
  <h2>Upload Magazine</h2>
  <form id="uploadForm" enctype="multipart/form-data">
    <input name="title" class="form-control mb-3" placeholder="Title" required>
    <input type="date" name="publishedDate" class="form-control mb-3">
    <input name="year" class="form-control mb-3" placeholder="Year" required>
    <select name="status" class="form-select mb-3">
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
    <div class="form-check mb-3">
      <input type="checkbox" name="featured" value="true" class="form-check-input">
      <label class="form-check-label">Featured</label>
    </div>
    <input type="file" name="pdf" accept=".pdf" class="form-control mb-3" required>
    <input type="file" name="cover" accept="image/*" class="form-control mb-3" required>
    <button id="submitBtn" class="btn btn-primary">Upload</button>
  </form>

  <div id="loading" class="mt-4 d-none">
    <div class="spinner-border"></div>
    Uploading...
  </div>

  <div id="successBox" class="alert alert-success mt-4 d-none">
    Upload complete âœ…
    <div class="mt-3">
      <a href="/" class="btn btn-outline-primary">Go Home</a>
    </div>
  </div>
</div>

<script>
const form = document.getElementById("uploadForm");
const loading = document.getElementById("loading");
const successBox = document.getElementById("successBox");
const btn = document.getElementById("submitBtn");

form.addEventListener("submit", async e=>{
  e.preventDefault();
  loading.classList.remove("d-none");
  successBox.classList.add("d-none");
  btn.disabled = true;

  const data = new FormData(form);
  const res = await fetch("/api/admin/magazines",{method:"POST",body:data});
  const json = await res.json();

  loading.classList.add("d-none");
  btn.disabled = false;

  if(json.success){
    successBox.classList.remove("d-none");
    form.reset();
  } else {
    alert(json.error || "Upload failed");
  }
});
</script>
</body>
</html>
