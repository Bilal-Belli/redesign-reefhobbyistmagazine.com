<!DOCTYPE html>
<html>

    <head>
        <title>RHM - Reset Password</title>
        <link rel="icon" type="image/png" href="/img/favicon.ico">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/style/clubs.css" />
        <style>
            /* Add this to clubs.css */
            body {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            section.py-5 {
                flex: 1;
            }
        </style>
    </head>

    <body>
        <!-- ================= NAV ================= -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-black">
            <div class="container">
                <a class="navbar-brand" href="/"><img src="./img/logo.jpg" alt="Magazine Logo" class="img-fluid"></a>
                <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div id="nav" class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link active" href="/">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="/archive">Archive</a></li>
                        <li class="nav-item"><a class="nav-link" href="/clubs">REEF Clubs</a></li>
                        <li class="nav-item"><a class="nav-link" href="/advertisers">Advertisers</a></li>
                        <li class="nav-item"><a class="nav-link" href="/stores">Stores</a></li>
                        <li class="nav-item"><a class="nav-link" target="_blank"
                                href="https://docs.google.com/forms/d/e/1FAIpQLSeB-HeqzgCeYOiM4rS6SiErttvq2fbg3pJOzWBSj2DH6lAtJA/viewform">Contact
                                Us</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- ================= SPONSORS ================= -->
        <section class="banner py-4 bg-light">
            <div class="container position-relative">
                <div class="swiper">
                    <div class="swiper-wrapper" id="sponsorSlides"></div>
                </div>
            </div>
        </section>

        <!-- ================= LOGIN FORM ================= -->
        <section class="py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-5">
                        <div class="card shadow-sm">
                            <div class="card-body p-5">
                                <h2 class="card-title text-center mb-4">Account Recovery</h2>
                                <form id="recoverForm">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" name="email"
                                            placeholder="your@email.com" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Receive email</button>
                                </form>
                                <div id="loginMessage" class="alert mt-3" style="display:none;"></div>
                                <div class="text-center mt-3">
                                    <p class="text-muted">Don't have an account? <a href="/subscribe">Register here</a>
                                    </p>
                                </div>
                                <div class="text-center mt-3">
                                    <p class="text-muted"><a href="/login">Login here</a>
                                    </p>
                                </div>
                                <div class="text-center mt-3">
                                    <p class="text-danger"><small>Please note that we have updated our login system. If you had an account before, please register again using your previous email account.</small></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= FOOTER ================= -->
        <footer>
            <div class="container text-center">
                <p>All Rights Reserved. Copyright ©
                    <script>document.write(new Date().getFullYear())</script> Reef Hobbyist Magazine
                </p>
                <p>
                    <a href="/advertisers">Advertisers</a> ·
                    <a target="_blank"
                        href="https://docs.google.com/forms/d/e/1FAIpQLSeB-HeqzgCeYOiM4rS6SiErttvq2fbg3pJOzWBSj2DH6lAtJA/viewform">Contact
                        Us</a>
                </p>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="./js/sponsorsSwiper.js"></script>
        <script src="./js/auth.js"></script>
        <script>
            document.getElementById("recoverForm").addEventListener("submit", async (e) => {
                e.preventDefault();
                const email = document.getElementById("email").value.trim();
                const btn = e.target.querySelector("button[type=submit]");
                const msg = document.getElementById("loginMessage");
                btn.disabled = true;
                btn.textContent = "Sending...";
                msg.style.display = "none";
                try {
                    const response = await fetch("/api/recoverAccount", {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ email })
                    });
                    const data = await response.json();
                    if (response.ok && data.success) {
                        btn.textContent = "Check your inbox!";
                        btn.classList.replace("btn-primary", "btn-success");
                    } else {
                        throw new Error(data.error || 'Failed to send recovery email');
                    }
                } catch (error) {
                    btn.disabled = false;
                    btn.textContent = "Receive email";
                    btn.classList.remove("btn-success", "btn-danger");
                    btn.classList.add("btn-primary");
                    msg.style.display = "block";
                    msg.className = "alert alert-danger mt-3";
                    msg.textContent = error.message;
                }
            });
        </script>
    </body>
</html>