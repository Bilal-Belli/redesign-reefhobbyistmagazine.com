<!DOCTYPE html>
<html>

    <head>
        <title>RHM - Register</title>
        <link rel="icon" type="image/png" href="/img/favicon.ico">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/style/home.css" />
    </head>

    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-black">
            <div class="container">
                <a class="navbar-brand" href="/"><img src="./img/logo.jpg" alt="Magazine Logo" class="img-fluid"></a>
                <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div id="nav" class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link active" href="/">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="/archive">Archive</a></li>
                        <li class="nav-item"><a class="nav-link" href="/clubs">REEF Clubs</a></li>
                        <li class="nav-item"><a class="nav-link" href="/advertisers">Advertisers</a></li>
                        <li class="nav-item"><a class="nav-link" target="_blank"
                                href="https://docs.google.com/forms/d/e/1FAIpQLSeB-HeqzgCeYOiM4rS6SiErttvq2fbg3pJOzWBSj2DH6lAtJA/viewform">Contact
                                Us</a></li>
                        <li class="nav-item"><a class="nav-link" href="/subscribe">Subscribe</a></li>
                        <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- ================= REGISTRATION FORM ================= -->
        <section class="py-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body p-5">
                                <h2 class="card-title text-center mb-4">Subscribe</h2>
                                <form id="registerForm">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="Your name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" name="email" placeholder="your@email.com" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="password" name="password" placeholder="Enter password" required>
                                        <small class="text-muted">Minimum 6 characters</small>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Register</button>
                                </form>
                                <div id="registerMessage" class="alert mt-3" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <footer>
            <div class="container text-center">
                <p>All Rights Reserved. Copyright ©
                    <script>document.write(new Date().getFullYear())</script> Reef Hobbyist Magazine
                </p>
                <p>
                    <a href="/advertisers">Advertisers</a> ·
                    <a target="_blank"
                        href="https://docs.google.com/forms/d/e/1FAIpQLSeB-HeqzgCeYOiM4rS6SiErttvq2fbg3pJOzWBSj2DH6lAtJA/viewform">Contact
                        Us</a>
                </p>
            </div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="./js/auth.js"></script>
        <script>
            document.getElementById("registerForm").addEventListener("submit", async (e) => {
                e.preventDefault();
                
                const name = document.getElementById("name").value.trim();
                const email = document.getElementById("email").value.trim();
                const password = document.getElementById("password").value;
                const messageEl = document.getElementById("registerMessage");
                
                // Validate password length
                if (password.length < 6) {
                    messageEl.className = "alert alert-danger";
                    messageEl.innerHTML = "Password must be at least 6 characters";
                    messageEl.style.display = "block";
                    return;
                }
                
                try {
                    const res = await fetch("/api/register", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ name, email, password })
                    });
                    
                    const data = await res.json();
                    
                    if (data.success) {
                        messageEl.className = "alert alert-success";
                        messageEl.innerHTML = "Registration successful ! You can now receive our newsletter to this email account and login to get full access on archive.";
                        messageEl.style.display = "block";
                        document.getElementById("registerForm").reset();
                    } else {
                        messageEl.className = "alert alert-danger";
                        messageEl.innerHTML = data.error || "Registration failed";
                        messageEl.style.display = "block";
                    }
                } catch (error) {
                    messageEl.className = "alert alert-danger";
                    messageEl.innerHTML = "Network error: " + error.message;
                    messageEl.style.display = "block";
                }
            });
        </script>
    </body>
</html>